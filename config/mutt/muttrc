set mbox_type=Maildir
set folder=$HOME/Maildir/
set header_cache     = ~/.mutt/cache/headers # where to store headers
set message_cachedir = ~/.mutt/cache/bodies  # where to store bodies
set mailcap_path     = ~/.mutt/mailcap       # entries for filetypes
# set spoolfile="+cern/INBOX"
set spoolfile="+subatech/INBOX"

# Basic Options --------------------------------------
set wait_key = no        # shut up, mutt
set mbox_type = Maildir  # mailbox type
set timeout = 3          # idle time before scanning
set mail_check = 0       # minimum time between scans
unset move               # gmail does that
set delete               # don't ask, just do
unset confirmappend      # don't ask, just do!
set quit                 # don't ask, just do!!
unset mark_old           # read/new is good enough for me
set pipe_decode          # strip headers and eval mimes when piping
set thorough_search      # strip headers and eval mimes before searching

mailboxes =TODO
mailboxes =subatech
mailboxes =subatech/INBOX
mailboxes =subatech/Admin
mailboxes =subatech/CCIPL
mailboxes =subatech/IMT
mailboxes =subatech/InfoSR
mailboxes =subatech/Junk
mailboxes =subatech/Missions
mailboxes =subatech/Univ


mailboxes =cern
mailboxes =cern/INBOX
mailboxes =cern/O2 =cern/O2/.CWG4 =cern/O2/.CWG13 =cern/O2/.CWG6 =cern/O2/.MRRTF
mailboxes =cern/MUON =cern/MUON/.MID =cern/MUON/.MTR =cern/MUON/.MCH
mailboxes =cern/GIT 
mailboxes =cern/GIT/.aliceo2 =cern/GIT/.aliphysics =cern/GIT/.aliroot =cern/GIT/.alibuild
mailboxes =cern/JIRA =cern/JIRA/.pwgpp =cern/JIRA/.aliroot
mailboxes =cern/OPS =cern/OPS/.build =cern/OPS/.dpg =cern/OPS/.lcg
mailboxes =cern/PWG =cern/PWG/.DQ =cern/PWG/.HF
mailboxes =cern/Papers =cern/Papers/.Jpsi-vs-multiplicity =cern/Papers/.Phi2mumu-PbPb =cern/Papers/.Phi2mumu-pA =cern/Papers/.Jpsi2mumu-pA-2013
mailboxes =cern/Archive

mailboxes =mu
mailboxes =mu/inbox-work =mu/sent

mailboxes =gmail
mailboxes =gmail/INBOX =gmail/Processed =gmail/free =gmail/laposte
mailboxes =gmail/pub =gmail/pub/.amazon =gmail/pub/.beauxarts

mailboxes =icloud
mailboxes =icloud/INBOX 

# Sidebar Patch 
set sidebar_visible = yes
set sidebar_width   = 35 
set sidebar_divider_char = '│'
set sidebar_format = "%B%* %?N?%N/?%S"
set mail_check_stats
set sidebar_short_path
# Shorten mailbox names
set sidebar_delim_chars="/"
# Delete everything up to the last / character
set sidebar_folder_indent
# Indent folders whose names we've shortened
set sidebar_indent_string="  "
# Indent with two spaces
#
# # Status Bar -----------------------------------------
set status_chars  = " *%A"
set status_format = "───[ Folder: %f ]───[%r%m messages%?n? (%n new)?%?d? (%d to delete)?%?t? (%t tagged)? ]───%>─%?p?( %p postponed )?───"

# Header Options -------------------------------------
ignore *                                # ignore all headers
unignore from: to: cc: date: subject: x-label:  # show only these
unhdr_order *                           # some distros order things by default
hdr_order to: cc: date: from: subject:  # and in this order

# Index View Options ---------------------------------
set date_format = "%d/%m/%y %H:%M"
set index_format = "[%Z] %?M?(%3M)&     ? %D  %-20.20F  %s"
set sort = threads                         # like gmail
set sort_aux = reverse-last-date-received  # like gmail
set uncollapse_jump                        # don't collapse on an unread message
set sort_re                                # thread based on regex
set reply_regexp = "^(([Rr][Ee]?(\[[0-9]+\])?: *)?(\[[^]]+\] *)?)*"

# Index Key Bindings ---------------------------------
bind index gg       first-entry
bind index G        last-entry

bind index R        group-reply
bind index <tab>    sync-mailbox
bind index <space>  collapse-thread

# sidebar bindings

bind index,pager <up> sidebar-prev
bind index,pager <down> sidebar-next
bind index,pager <right> sidebar-open

# Pager View Options ---------------------------------
#set pager_index_lines = 10 # number of index lines to show
#set pager_context = 3      # number of context lines to show
set pager_stop             # don't go to next message automatically
set menu_scroll            # scroll in menus
set tilde                  # show tildes like in vim
unset markers              # no ugly plus signs

macro pager \Cu "|urlview<enter>" "call urlview to open links"

set quote_regexp = "^( {0,4}[>|:#%]| {0,4}[a-z0-9]+[>|]+)+"
#set quote_regexp = “^([ \t]*[|>:}#])+”

# Pager Key Bindings ---------------------------------
bind pager k  previous-line
bind pager j  next-line
bind pager gg top
bind pager G  bottom

bind pager R  group-reply

# View attachments properly.
bind attach <return> view-mailcap

# # Compose View Options -------------------------------
set realname = "Laurent Aphecetche"          # who am i?
set envelope_from                    # which from?
set sig_dashes                       # dashes before sig
set edit_headers                     # show headers when composing
set fast_reply                       # skip to compose when replying
set askcc                            # ask for CC:
set fcc_attach                       # save attachments with the body
unset mime_forward                   # forward attachments as part of body
set forward_format = "Fwd: %s"       # format of subject when forwarding
set forward_decode                   # decode when forwarding
set attribution = "On %d, %n wrote:" # format of quoting header
set reply_to                         # reply to Reply to: field
set reverse_name                     # reply as whomever it was to
set include                          # include message in replies
set forward_quote                    # include message in forwards

bind compose p postpone-message
bind index p recall-message

macro index \Ca "<limit>all\n" "show all messages (undo limit)"

#set editor = "vim"

auto_view text/html
alternative_order text/plain text/enriched text/html

folder-hook gmail/* source ~/.mutt/accounts/gmail
folder-hook icloud/* source ~/.mutt/accounts/icloud
folder-hook cern/* source ~/.mutt/accounts/cern
folder-hook subatech/* source ~/.mutt/accounts/subatech

source ~/.mutt/colors

# mu
#
bind editor <Tab> complete-query
set query_command = "mu cfind --format=mutt-ab  '%s'"
macro index Z "<shell-escape>mu find --clearlinks --format=links --linksdir=~/.mu/results " "mu find"
macro index ,mu "<change-folder-readonly>~/.mu/results<enter>" "mu find results"

macro pager,index ,tw "<pipe-message>~/dotfiles/bin/mutt2taskwarrior.sh<enter> <save-message>=TODO<enter><edit-label>taskwarrior<enter>" "convert mail to taskwarrior task"

# labels (aka keywords)
bind index,pager y edit-label

source ~/.mutt/smime.rc
